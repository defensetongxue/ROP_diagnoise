# Official Implementation for "ROP-Marker: an evidence-oriented AI assistant for ROP diagnosis"

这是一个代码库，主要包含了"ROP-Marker: an evidence-oriented AI assistant for ROP diagnosis"的代码。由于该项目涉及多个相对独立的模块，每个模块都支持独立复用，我们将其分成不同的代码仓库存储。希望该项目的代码能帮助到你，如果你有任何问题，可以在issue中提出。

项目的流程示意图
<div align="center">
    <img src="systemStructure.png" width="75%">
</div>

## 仓库目录
- **图像增强**: 本仓库 [./ImageEnhancer.py](./ImageEnhancer.py)
- **视盘定位**: [https://github.com/defensetongxue/optic_disc_location](https://github.com/defensetongxue/optic_disc_location)
- **病灶分割**: [https://github.com/defensetongxue/ridge_segmentation](https://github.com/defensetongxue/ridge_segmentation)
- **ROP 区域计算（角度计算）**: [https://github.com/defensetongxue/ROP_Zone](https://github.com/defensetongxue/ROP_Zone)
- **ROP 分期（样本和分期）**: [https://github.com/defensetongxue/SentenceROP](https://github.com/defensetongxue/SentenceROP)
- **ROP 基线模型**: 我们重构了目前工业界的其他模型用于ROP 检验，参考 [https://github.com/defensetongxue/ROP_BaseLine](https://github.com/defensetongxue/ROP_BaseLine)
- **Demo**: 我们在ShenZhenROPdataset上进行了测试，该仓库可以用于在其他数据集上进行测试，我们拟公开了一组模型：[https://github.com/defensetongxue/ROP_demo](https://github.com/defensetongxue/ROP_demo)
- **模拟实验**: 我们进行了模拟实验，编写了单个Html进行相关模拟实验：[https://github.com/defensetongxue/ROP_assistance_demo](https://github.com/defensetongxue/ROP_assistance_demo)

## 使用说明

### 代码结构

为了实现多个仓库的协同，我个人提出的解决方案是让每个仓库都使用相同的数据结构作为接口。

```plaintext
data_path
    images
        1.jpg
        2.jpg
        ...
    enhanced
        1.jpg
        2.jpg
        ...
    ... 其余中间结果
    annotations.json
```
annotations.json 包含所有数据的信息，每一条数据都是一个json对线，当一个仓库对齐进行操作，其他将会对其进行修改，例如新增一个key："ridge_diffusion_path", 使得其它仓库可以访问生成的ROP lesion 分割标签。

最初 annotations会包含每条数据的初始文件路径,和id例如
```python
# 最初的anntation示例
{
    "1.jpg":{
        "id":1,
        "image_path": "data_path/images/1.jpg"
    },
    "2.jpg":{
        ...
    },
    ...
}
```

### 文件组织方式
为了便于复用，每个仓库都是以相同的风格组织文件，并不存在一个Make everything ok的一键运行方式。每个项目中，根目录的每一个文件往往执行各种功能，例如

train.py 会进行模型的训练

test.py 会测试，有可能会存储结果于一个record.json文件进行作图

util 文件夹包含一些小巧的工具，例如生成可视化结果，或者单次train和eval的循环

experiments 会存储一写中间结果（记录，作图）等，也会作为torch预训练模型的下载目录

checkpoint 存储模型训练结果